{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- âœ… Full-width Banner -->
<div class="banner-full">
    <img src="{% static 'images/vls-banner.png' %}" alt="Vijayalakshmi Silks">
</div>

<!-- ðŸ§º Product Listing -->
<div class="collection-section">
    {% for product in products %}
    <div class="saree-card">
        <div class="image-container">
            {% for image in product.images.all %}
                <img src="{{ image.image.url }}"
                     class="saree-image saree-image-{{ product.id }}"
                     onclick="zoomImage(this)"
                     {% if not forloop.first %}style="display:none;"{% endif %}>
            {% endfor %}
            {% if product.images.count > 1 %}
                <button onclick="prevImage({{ product.id }})" class="carousel-btn left">&#10094;</button>
                <button onclick="nextImage({{ product.id }})" class="carousel-btn right">&#10095;</button>
                <div class="image-index" id="index-{{ product.id }}">1 / {{ product.images.count }}</div>
            {% endif %}
        </div>
        <h3>{{ product.name }}</h3>
        <p class="price">â‚¹ {{ product.price }}</p>
        <a href="{% url 'product_detail' product.id %}" class="btn buy-now">View</a>
        <a href="{% url 'add_to_cart' product.id %}" class="btn add-cart">Add to Cart</a>
    </div>
    {% empty %}
        <p>No products available right now.</p>
    {% endfor %}
</div>

<!-- ðŸ” Zoom Modal -->
<div id="zoomModal" class="zoom-modal">
    <span onclick="closeModal()">&times;</span>
    <img id="zoomedImage" src="">
</div>

<script>
    const imageIndexes = {};

    function nextImage(id) {
        const images = document.querySelectorAll(`.saree-image-${id}`);
        if (!(id in imageIndexes)) imageIndexes[id] = 0;
        images[imageIndexes[id]].style.display = 'none';
        imageIndexes[id] = (imageIndexes[id] + 1) % images.length;
        images[imageIndexes[id]].style.display = 'block';
        document.getElementById(`index-${id}`).innerText = `${imageIndexes[id] + 1} / ${images.length}`;
    }

    function prevImage(id) {
        const images = document.querySelectorAll(`.saree-image-${id}`);
        if (!(id in imageIndexes)) imageIndexes[id] = 0;
        images[imageIndexes[id]].style.display = 'none';
        imageIndexes[id] = (imageIndexes[id] - 1 + images.length) % images.length;
        images[imageIndexes[id]].style.display = 'block';
        document.getElementById(`index-${id}`).innerText = `${imageIndexes[id] + 1} / ${images.length}`;
    }

    function zoomImage(img) {
        document.getElementById("zoomedImage").src = img.src;
        document.getElementById("zoomModal").style.display = "flex";
    }

    function closeModal() {
        document.getElementById("zoomModal").style.display = "none";
    }
</script>

{% endblock %}

